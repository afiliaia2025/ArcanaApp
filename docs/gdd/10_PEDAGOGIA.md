# 10 Â· PedagogÃ­a y DetecciÃ³n de Dificultades
> **Ãšltima actualizaciÃ³n**: 2026-02-21
> PrÃ¡cticas pedagÃ³gicas basadas en evidencia cientÃ­fica + Sistema de detecciÃ³n temprana de dificultades de aprendizaje.

---

## PARTE 1: PrÃ¡cticas PedagÃ³gicas con Mayor Evidencia

> Fuentes: John Hattie (Visible Learning, 2100+ meta-anÃ¡lisis), Self-Determination Theory (Deci & Ryan), NIH, Ed.gov, Frontiers in Education 2024.

### Las 10 estrategias que DEBE implementar ArcanaApp

| # | PrÃ¡ctica | Efecto (Hattie) | CÃ³mo lo implementamos | Estado |
|---|---|---|---|---|
| 1 | **Feedback inmediato elaborado** | 0.70-0.90 | OriÃ³n explica POR QUÃ‰ la respuesta es correcta/incorrecta + pista en fallo 1 + respuesta en fallo 2 | âœ… DiseÃ±ado |
| 2 | **Retrieval Practice** (recuperaciÃ³n activa) | 0.79 | Bosses = exÃ¡menes de recuperaciÃ³n. Pergaminos Olvidados = repaso activo de temas previos | âš ï¸ AÃ±adir Pergaminos |
| 3 | **Spaced Repetition** (repeticiÃ³n espaciada) | 0.65+ | Mini-bosses repasan temas. Cada concepto aparece en 3 contextos (introâ†’refuerzoâ†’boss). Pergaminos Olvidados cada X dÃ­as | âš ï¸ AÃ±adir Pergaminos |
| 4 | **EvaluaciÃ³n formativa continua** | 0.90 | Mini-bosses parciales (5/5 por tema) = evaluaciones cortas y frecuentes | âœ… DiseÃ±ado |
| 5 | **AutonomÃ­a del alumno** (SDT) | Alto | El niÃ±o elige reino y capÃ­tulo. Elige quÃ© runa usar. Elige cuÃ¡ndo practicar | âœ… DiseÃ±ado |
| 6 | **Competencia progresiva** (SDT) | Alto | Curva T1â†’T2â†’T3 (Reconocerâ†’Aplicarâ†’Razonar). Modo Ayuda adaptativo | âœ… DiseÃ±ado |
| 7 | **Sentido de pertenencia** (SDT) | Alto | OriÃ³n como compaÃ±ero emocional. NPCs con personalidad. El Archimago como mentor | âœ… DiseÃ±ado |
| 8 | **Scaffolding** (andamiaje) | 0.82 | T1 con hints abundantes â†’ T2 moderados â†’ T3 solo en Modo Ayuda. Opciones pasan de 2â†’3â†’4 | âœ… DiseÃ±ado |
| 9 | **Teacher Clarity** (objetivo visible) | 0.75 | OriÃ³n dice al inicio del cap quÃ© va a aprender el niÃ±o | ğŸ†• AÃ±adir |
| 10 | **GamificaciÃ³n con significado** | Positivo | XP, runas, estrellas, vestuario. Todo con narrativa, nunca solo nÃºmeros | âœ… DiseÃ±ado |

### 3 Mejoras Nuevas Basadas en la InvestigaciÃ³n

#### 1. ğŸ“œ Pergaminos Olvidados (Spaced Repetition)

> La ciencia dice: repasar un tema X dÃ­as despuÃ©s multiplica la retenciÃ³n por 3Ã— (NIH).

```
Cada 3-5 dÃ­as, OriÃ³n trae un pergamino:

ğŸ¦‰ "Â¡Aprendiz! He encontrado un pergamino antiguo mientras
   limpiaba mi nido. Parece... Â¡un reto del pasado!"

â†’ 3-5 preguntas de temas que el niÃ±o completÃ³ hace dÃ­as/semanas
â†’ Temas seleccionados por algoritmo: prioriza los que tuvieron mÃ¡s fallos
â†’ Recompensa: +15 XP + Polvo Estelar
â†’ Sin penalizaciÃ³n si no los hace (son opcionales)
```

| Aspecto | Detalle |
|---|---|
| **Frecuencia** | Cada 3-5 dÃ­as (configurable por el profe) |
| **SelecciÃ³n** | Algoritmo: prioriza temas con mayor tasa de error |
| **Cantidad** | 3-5 preguntas (nunca mÃ¡s) |
| **Timer** | NO (son de repaso, no de evaluaciÃ³n) |
| **Obligatorio** | NO. OriÃ³n los ofrece, el niÃ±o decide |

#### 2. ğŸ¯ Objetivo Visible del CapÃ­tulo

> Hattie: saber "quÃ© voy a aprender hoy" tiene efecto 0.75 (enorme).

```
Al empezar cada capÃ­tulo:

ğŸ¦‰ "Hoy dominaremos: SUMAS CON LLEVADA"
ğŸ¦‰ "Al terminar, sabrÃ¡s sumar nÃºmeros grandes sin despeinarte."

[Icono del tema]  [Barra vacÃ­a que se llena durante el cap]
```

**Reglas:** Siempre narrativo, nunca "Objetivo: el alumno sabrÃ¡...". Breve (1 frase). Con icono visual.

#### 3. âœï¸ Input Mixto (no solo multiple choice)

> NIH: generar la respuesta (escribirla/construirla) > elegir entre opciones. El esfuerzo de recuperaciÃ³n fortalece la memoria.

| Tipo de input | CuÃ¡ndo | Ejemplo |
|---|---|---|
| **Multiple choice** (3-4 opciones) | 60% de ejercicios | "347 + 258 = ?" â†’ [505] [605] [595] [615] |
| **Arrastrar para construir** | 25% de ejercicios | Arrastrar cifras 6-0-5 al hueco para formar "605" |
| **Ordenar secuencia** | 10% de ejercicios | Arrastrar sÃ­labas en orden: [ma]-[ri]-[po]-[sa] |
| **Escribir (solo Babel T3)** | 5% de ejercicios | Escribir la palabra en inglÃ©s (con teclado simplificado) |

**Regla:** NUNCA teclado libre en T1 ni T2. Solo en Babel T3 y siempre con teclado simplificado (letras grandes, sin caracteres especiales).

---

## PARTE 2: Sistema de DetecciÃ³n Temprana â€” "Ojo de OriÃ³n"

> **DISCLAIMER LEGAL**: ArcanaApp NUNCA diagnostica. Solo detecta patrones y alerta a padres/profesores para que consulten a un profesional.
> Fuentes: NIH, JMIR, UCSF, Kennedy Krieger Institute, UMass, Sleep Foundation, Frontiers in Education, CDC, BDA, ChildMind.org.

### La Idea

ArcanaApp ya recopila datos que la investigaciÃ³n identifica como **biomarcadores digitales** (NIH, JMIR, UCSF 2024). Sin hardware extra, solo analizando patrones de juego, podemos detectar seÃ±ales tempranas de **9 condiciones diferentes**.

---

### Las 9 condiciones detectables

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CONDICIONES DETECTABLES                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COGNITIVAS       â”‚ 1. TDAH (inatento/hiperactivo)   â”‚
â”‚                  â”‚ 2. Dislexia                       â”‚
â”‚                  â”‚ 3. Discalculia                    â”‚
â”‚                  â”‚ 4. TEA (Trastorno Espectro Autista)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EMOCIONALES      â”‚ 5. Ansiedad                      â”‚
â”‚                  â”‚ 6. DepresiÃ³n / ApatÃ­a             â”‚
â”‚                  â”‚ 7. Acoso escolar (bullying)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FÃSICAS          â”‚ 8. Problemas de visiÃ³n            â”‚
â”‚                  â”‚ 9. Falta de sueÃ±o                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TALENTO          â”‚ 10. Altas capacidades no atendidasâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1. ğŸ”´ TDAH (Trastorno por DÃ©ficit de AtenciÃ³n)

> **Fuentes**: NIH, JMIR 2024, CELDA 2024. **Biomarcador clave**: RT-ISV (variabilidad intra-sujeto del tiempo de respuesta).

| Indicador | QuÃ© medimos | Umbral de alerta |
|---|---|---|
| **Variabilidad de RT** (RT-ISV) | DesviaciÃ³n estÃ¡ndar del tiempo de respuesta | > 3Ã— la media del grupo de edad |
| **Abandono de sesiÃ³n** | % de caps empezados y no terminados | > 40% en 2 semanas |
| **Efecto principio-final** | Acierta al inicio del cap, falla al final | CaÃ­da > 40% entre 1Âª y Ãºltima pregunta |
| **Respuestas impulsivas** | Responder en < 1.5s (antes de leer) | > 20% de respuestas ultra-rÃ¡pidas |
| **Inconsistencia entre sesiones** | Un dÃ­a rinde al 90%, otro al 30% | DesviaciÃ³n > 25% entre sesiones |

**Lo que hace la ciencia**: Los niÃ±os con TDAH muestran variabilidad extrema en tiempos de respuesta â€” no es que sean lentos, sino que alternan entre respuestas rÃ¡pidas y "lagunas" de 15-20 segundos (lapsos atencionales). Esto es medible y diferenciador.

---

### 2. ğŸŸ¡ Dislexia

> **Fuentes**: BDA (British Dyslexia Association), ReadSource, Yale Center for Dyslexia.

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **Uso excesivo de TTS** | Clicks en botÃ³n ğŸ”Š por pantalla | > 70% pantallas con TTS (vs 30% media) |
| **ConfusiÃ³n letras espejo** | Errores bâ†”d, pâ†”q en Lexis | > 5 ocurrencias en T1 |
| **Perfil espinoso** | Rendimiento Lexis vs Ignis | Lexis < 50% con Ignis > 75% |
| **Tiempo de lectura anormal** | Segundos por pantalla de texto | > 2Ã— la media del grupo |
| **Errores de secuencia** | InversiÃ³n de sÃ­labas/letras al ordenar | > 30% en ejercicios de ordenar |

---

### 3. ğŸŸ¡ Discalculia

> **Fuentes**: ChildMind.org, Child-Encyclopedia, DyscalculiaServices.

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **ConfusiÃ³n valor posicional** | Errores 35â†”53, 72â†”27 | > 3 ocurrencias |
| **Tablas de multiplicar** | Acierto en Ã—2, Ã—5, Ã—10 tras T2 | < 30% Ã©xito |
| **Conteo con dedos** (inferido) | Tiempos de 8-12s en sumas simples de T1 | Consistente en > 50% ejercicios |
| **Perfil espinoso inverso** | Ignis vs Lexis | Ignis < 50% con Lexis > 75% |
| **No reconocer patrones de dados** | En ejercicios visuales de cantidad | Fallar > 40% |

---

### 4. ğŸ”µ TEA (Trastorno del Espectro Autista)

> **Fuentes**: Kennedy Krieger Institute, NIH, MDPI 2024. **Nota**: La detecciÃ³n de TEA por app es la mÃ¡s limitada de todas, pero hay seÃ±ales.

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **Patrones repetitivos** | Repetir el mismo cap 10+ veces sin probar otros | > 10 repeticiones del mismo cap, ignorando caps nuevos |
| **Rigidez en elecciÃ³n de reino** | Solo juega 1 reino, rechaza los demÃ¡s | 100% de sesiones en 1 solo reino durante > 4 semanas |
| **Tiempo fijo en rutinas** | Juega siempre a la misma hora exacta | Varianza < 5 min en hora de inicio durante > 2 semanas |
| **Dificultad con ejercicios sociales** | En Lexis: interpretar emociones/intenciones de personajes | < 40% acierto en tipo "Â¿CÃ³mo se siente el personaje?" |
| **Reacciones atÃ­picas al cambio** | Abandono al cambiar interfaz o tipo de ejercicio | > 50% abandono tras eventos de actualizaciÃ³n |

---

### 5. ğŸŸ£ Ansiedad

> **Fuentes**: UMass, NIH, Frontiers in Education. **Biomarcador clave**: patrÃ³n de evitaciÃ³n + tiempos excesivos.

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **EvitaciÃ³n de bosses** | # de veces que abre boss pero sale sin intentar | > 3 veces seguidas abre y cierra sin responder |
| **Tiempo excesivo antes de responder** | Segundos mirando la pregunta antes de tocar | > 15s de media (vs 4s media normal) |
| **Uso compulsivo de runas** | Activar runas siempre, incluso en ejercicios fÃ¡ciles | Usa runa en > 80% de ejercicios (incluyendo T1) |
| **RegresiÃ³n tras fallo** | Rendimiento cae drÃ¡sticamente tras un solo error | CaÃ­da > 50% de acierto tras 1 fallo en la sesiÃ³n |
| **Reintento obsesivo del mismo cap** | Repetir cap ya completado para "asegurar" estrellas | > 5 repeticiones de cap con 3/3 estrellas |

---

### 6. ğŸŸ¤ DepresiÃ³n / ApatÃ­a

> **Fuentes**: JMIR, NIH, UMass. **Biomarcador clave**: cambio brusco en patrones de actividad.

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **Abandono progresivo** | Frecuencia de uso decreciente sin causa | De 5 sesiones/semana a < 1 en 3 semanas |
| **Sesiones ultra-cortas** | DuraciÃ³n de sesiÃ³n | < 2 min (abre y cierra sin jugar) |
| **Indiferencia al feedback** | No reacciona a celebraciones ni recompensas | Velocidad constante (no se acelera con XP bonus) |
| **CaÃ­da de rendimiento global** | Todas las asignaturas bajan a la vez | Descenso > 20% en TODAS las asignaturas en 2 semanas |
| **Hora de juego nocturna** | Juega despuÃ©s de las 22:00 regularmente | > 50% sesiones despuÃ©s de las 22h durante > 1 semana |

---

### 7. ğŸŸ  Acoso Escolar (Bullying)

> **Fuentes**: SchoolSafety.gov, NIH, KidsHealth. Solo detectable en **Modo Aula** (cuando varios niÃ±os juegan simultÃ¡neamente con el Archimago/profesor activo).

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **Aislamiento sÃºbito** | NiÃ±o deja de jugar cuando estÃ¡ en Modo Aula pero juega solo en casa | > 2 semanas de inactividad en Aula pero activo en casa |
| **Abandono tras ranking** | Sale del juego tras ver la tabla de rÃ©cords | > 3 abandonos justo despuÃ©s de ver rankings |
| **CaÃ­da brusca de rendimiento** | Rendimiento normal â†’ colapso repentino | CaÃ­da > 30% en < 1 semana sin causa acadÃ©mica |

**âš ï¸ Esta detecciÃ³n es la mÃ¡s delicada y requiere validaciÃ³n profesional antes de implementar.**

---

### 8. ğŸ‘ï¸ Problemas de VisiÃ³n

> **Fuentes**: CDC, AAO (American Academy of Ophthalmology), AllAboutVision. Hasta el 80% del aprendizaje escolar es visual.

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **Acercar la pantalla** | Zoom/pinch gestures durante ejercicios | > 5 zooms por sesiÃ³n (medible en tablets/mÃ³viles) |
| **Errores en Ã­tems con texto pequeÃ±o** | Falla Ã­tems con letras pequeÃ±as, acierta los grandes | Diferencia > 40% entre Ã­tems texto-grande vs texto-pequeÃ±o |
| **Uso excesivo de TTS + NO dislexia** | Usa TTS pero no confunde letras ni sÃ­labas | TTS > 60% SIN otros indicadores de dislexia |
| **Rendimiento por hora** | Rinde peor por la tarde (fatiga visual) | Acierto maÃ±ana > 70%, tarde < 50% consistentemente |

---

### 9. ğŸ˜´ Falta de SueÃ±o

> **Fuentes**: Sleep Foundation, NIH, McGill University. 1 hora menos de sueÃ±o = 2 aÃ±os de retraso cognitivo.

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **Hora de juego** | Timestamps de sesiones | Juega regularmente despuÃ©s de las 23:00 |
| **Rendimiento lunes vs viernes** | Comparar acierto inicio de semana vs fin | CaÃ­da > 20% los lunes consistentemente |
| **Tiempos de reacciÃ³n matutinos** | RT en las primeras 3 preguntas del dÃ­a | RT maÃ±ana > 2Ã— RT tarde en el mismo niÃ±o |
| **"MicrosueÃ±os"** (inferidos) | Pausas de 30+ segundos sin tocar la pantalla | > 3 pausas por sesiÃ³n de > 30s |

---

### 10. ğŸŒŸ Altas Capacidades No Atendidas

> **Fuentes**: NAGC (National Assoc. for Gifted Children), SchoolAnalytix, Ed.gov. Un niÃ±o superdotado aburrido puede parecer que tiene TDAH.

| Indicador | QuÃ© medimos | Umbral |
|---|---|---|
| **Rendimiento perfecto ultrarrÃ¡pido** | 10/10 en < 50% del tiempo medio | Consistente en > 80% de caps |
| **Aburrimiento** | Abandona caps fÃ¡ciles pero completa los difÃ­ciles | Ratio inversamente proporcional a dificultad |
| **Bajo rendimiento deliberado** | Respuestas aleatorias rÃ¡pidas (< 1s) | > 30% de respuestas en < 1s con patrÃ³n random |
| **Busca desafÃ­os extras** | Completa todos los puzzles ocultos y desafÃ­os extra | 100% de desafÃ­os extras encontrados |
| **Pide mÃ¡s** | Repite caps pero siempre con el timer mÃ¡s ajustado | Siempre en los percentiles mÃ¡s altos de velocidad |

**Alerta diferente**: En lugar de "podrÃ­a necesitar ayuda", la alerta dice: *"Su hijo muestra un rendimiento excepcional que podrÃ­a beneficiarse de retos adicionales. Consulte con el orientador sobre programas de enriquecimiento."*

---

### ğŸ”§ CÃ“MO DETECTAR CADA CONDICIÃ“N (Plan de ImplementaciÃ³n)

> PseudocÃ³digo y lÃ³gica paso a paso para que un desarrollador pueda implementar cada detector.

---

#### Paso 0: Modelo de datos base

Cada vez que el niÃ±o responde un ejercicio, guardar en Firestore:

```dart
// Firestore: exercises/{uid}/sessions/{sessionId}/events/{eventId}
class ExerciseEvent {
  final DateTime timestamp;
  final int responseTimeMs;       // Milisegundos desde que se muestra la pregunta
  final bool isCorrect;
  final String exerciseType;      // 'suma', 'lectura', 'vocabulario', etc.
  final String kingdom;           // 'ignis', 'lexis', 'sylva', 'babel'
  final int trimester;            // 1, 2, 3
  final String? errorType;        // 'mirror_letter', 'positional_value', null
  final bool ttsUsed;             // true si pulsÃ³ ğŸ”Š
  final String? runeUsed;         // 'fire', 'water', null
  final int exercisePosition;     // 1, 2, 3... posiciÃ³n dentro del cap
  final int totalExercises;       // total ejercicios del cap
  final String? gestureType;      // 'tap', 'drag', 'pinch_zoom', null
}

// Firestore: exercises/{uid}/sessions/{sessionId}
class SessionMeta {
  final DateTime startTime;
  final DateTime? endTime;        // null si abandonÃ³
  final int chaptersCompleted;
  final String mode;              // 'adventure', 'boss', 'tower', 'practice'
  final bool isClassroomMode;     // true si Modo Aula
}
```

---

#### Detector 1: TDAH â†’ `detectTDAH(uid)`

```
FUNCIÃ“N detectTDAH(uid, Ãºltimas_2_semanas):

  1. OBTENER todos los responseTimeMs del alumno
  2. CALCULAR Ïƒ (desviaciÃ³n estÃ¡ndar) de los tiempos
  3. OBTENER Ïƒ_media del grupo de edad (cache semanal)

  â”€â”€ Indicador A: Variabilidad â”€â”€
  SI Ïƒ_alumno > 3 Ã— Ïƒ_media:
    score_variabilidad = ğŸ”´ ALTO

  â”€â”€ Indicador B: Abandono â”€â”€
  CONTAR sesiones donde endTime == null (nunca terminÃ³)
  SI abandonos > 40% de sesiones:
    score_abandono = ğŸ”´ ALTO

  â”€â”€ Indicador C: Efecto principio-final â”€â”€
  PARA CADA sesiÃ³n:
    acierto_primera_mitad = % acierto en exercisePosition <= totalExercises/2
    acierto_segunda_mitad = % acierto en exercisePosition > totalExercises/2
  SI caÃ­da_media > 40%:
    score_decaimiento = ğŸŸ¡ MEDIO

  â”€â”€ Indicador D: Impulsividad â”€â”€
  CONTAR respuestas donde responseTimeMs < 1500ms
  SI > 20% del total:
    score_impulsividad = ğŸŸ¡ MEDIO

  â”€â”€ DecisiÃ³n final â”€â”€
  SI 2+ indicadores en ğŸ”´ O 3+ en ğŸŸ¡:
    GENERAR alerta ğŸ”´ "AtenciÃ³n â€” Patrones de concentraciÃ³n"
  SI 1 indicador en ğŸ”´ O 2 en ğŸŸ¡:
    GENERAR observaciÃ³n ğŸŸ¡
```

---

#### Detector 2: Dislexia â†’ `detectDislexia(uid)`

```
FUNCIÃ“N detectDislexia(uid, Ãºltimas_4_semanas):

  â”€â”€ Indicador A: TTS excesivo â”€â”€
  total_pantallas = COUNT(pantallas de texto mostradas)
  pantallas_con_tts = COUNT(donde ttsUsed == true)
  ratio_tts = pantallas_con_tts / total_pantallas
  SI ratio_tts > 0.70:
    score_tts = ğŸ”´ ALTO

  â”€â”€ Indicador B: ConfusiÃ³n letras espejo â”€â”€
  errores_espejo = COUNT(donde errorType == 'mirror_letter')
  // mirror_letter: confunde bâ†”d, pâ†”q, mâ†”w
  SI errores_espejo > 5 en T1:
    score_espejo = ğŸ”´ ALTO

  â”€â”€ Indicador C: Perfil espinoso â”€â”€
  acierto_lexis = % acierto global en kingdom == 'lexis'
  acierto_ignis = % acierto global en kingdom == 'ignis'
  SI acierto_lexis < 50% Y acierto_ignis > 75%:
    score_perfil = ğŸŸ¡ MEDIO

  â”€â”€ Indicador D: Errores de secuencia â”€â”€
  errores_orden = COUNT(donde errorType == 'sequence_inversion')
  total_orden = COUNT(ejercicios de tipo 'ordenar_silabas')
  SI errores_orden / total_orden > 0.30:
    score_secuencia = ğŸŸ¡ MEDIO

  â”€â”€ DecisiÃ³n â”€â”€
  SI score_tts == ğŸ”´ Y (score_espejo == ğŸ”´ O score_perfil == ğŸŸ¡):
    GENERAR alerta ğŸ”´ "Lectura â€” Posible beneficio de apoyo"
  SI cualquier 1 indicador en ğŸ”´:
    GENERAR observaciÃ³n ğŸŸ¡
```

---

#### Detector 3: Discalculia â†’ `detectDiscalculia(uid)`

```
FUNCIÃ“N detectDiscalculia(uid, Ãºltimas_4_semanas):

  â”€â”€ Indicador A: Valor posicional â”€â”€
  errores_pos = COUNT(donde errorType == 'positional_value')
  // positional_value: confunde 35â†”53, 72â†”27
  SI errores_pos > 3:
    score_posicional = ğŸ”´ ALTO

  â”€â”€ Indicador B: Tablas de multiplicar (solo post-T2) â”€â”€
  SI alumno_ha_completado_T2:
    acierto_tablas = % acierto en exerciseType == 'multiplication'
    SI acierto_tablas < 30%:
      score_tablas = ğŸ”´ ALTO

  â”€â”€ Indicador C: Conteo lento (inferido) â”€â”€
  tiempos_sumas_t1 = AVG(responseTimeMs) donde exerciseType == 'suma_simple'
  SI tiempos_sumas_t1 > 10000ms (10 seg para sumas de T1):
    score_conteo = ğŸŸ¡ MEDIO  // Probablemente cuenta con dedos

  â”€â”€ Indicador D: Perfil espinoso inverso â”€â”€
  SI acierto_ignis < 50% Y acierto_lexis > 75%:
    score_perfil = ğŸŸ¡ MEDIO

  â”€â”€ DecisiÃ³n â”€â”€
  SI 2+ indicadores en ğŸ”´:
    GENERAR alerta ğŸ”´ "MatemÃ¡ticas â€” Patrones persistentes"
  SI 1 en ğŸ”´ O 2+ en ğŸŸ¡:
    GENERAR observaciÃ³n ğŸŸ¡
```

---

#### Detector 4: TEA â†’ `detectTEA(uid)`

```
FUNCIÃ“N detectTEA(uid, Ãºltimas_4_semanas):

  â”€â”€ Indicador A: RepeticiÃ³n excesiva â”€â”€
  cap_mas_repetido = MAX(COUNT por chapterId)
  caps_nuevos_disponibles = COUNT(caps desbloqueados no jugados)
  SI cap_mas_repetido > 10 Y caps_nuevos_disponibles > 3:
    score_repeticion = ğŸŸ¡ MEDIO

  â”€â”€ Indicador B: Rigidez de reino â”€â”€
  sesiones_por_reino = GROUP BY kingdom
  SI un solo reino tiene 100% de las sesiones durante > 4 semanas:
    score_rigidez = ğŸŸ¡ MEDIO

  â”€â”€ Indicador C: Rutina temporal â”€â”€
  horas_inicio = LIST(hora de startTime de cada sesiÃ³n)
  Ïƒ_hora = DESV_ESTANDAR(horas_inicio en minutos)
  SI Ïƒ_hora < 5 minutos durante > 2 semanas (>10 sesiones):
    score_rutina = ğŸŸ¡ MEDIO

  â”€â”€ Indicador D: Ejercicios sociales â”€â”€
  acierto_social = % acierto en exerciseType IN ('emotion_reading', 'character_intention')
  SI acierto_social < 40%:
    score_social = ğŸŸ¡ MEDIO

  â”€â”€ DecisiÃ³n â”€â”€
  // TEA requiere MÃS indicadores simultÃ¡neos (alta especificidad)
  SI 3+ indicadores en ğŸŸ¡:
    GENERAR observaciÃ³n ğŸŸ¡ "Patrones â€” Consultar orientador"
  // NUNCA ğŸ”´ para TEA: demasiado delicado para alertar fuerte
```

---

#### Detector 5: Ansiedad â†’ `detectAnsiedad(uid)`

```
FUNCIÃ“N detectAnsiedad(uid, Ãºltimas_2_semanas):

  â”€â”€ Indicador A: EvitaciÃ³n de bosses â”€â”€
  aperturas_boss = COUNT(sesiones donde mode == 'boss')
  intentos_boss = COUNT(sesiones boss con >= 1 respuesta)
  SI aperturas_boss - intentos_boss >= 3:
    score_evitacion = ğŸ”´ ALTO  // Abre el boss 3+ veces sin intentar

  â”€â”€ Indicador B: ParÃ¡lisis ante la pregunta â”€â”€
  media_rt = AVG(responseTimeMs) en ejercicios NO-boss
  SI media_rt > 15000ms (15s):
    score_paralisis = ğŸŸ¡ MEDIO

  â”€â”€ Indicador C: Uso compulsivo de runas â”€â”€
  ejercicios_con_runa = COUNT(donde runeUsed != null)
  total_ejercicios = COUNT(todos)
  SI ejercicios_con_runa / total > 0.80:
    score_runas = ğŸŸ¡ MEDIO

  â”€â”€ Indicador D: RegresiÃ³n tras fallo â”€â”€
  PARA CADA sesiÃ³n:
    encontrar primer fallo
    acierto_antes = % acierto antes del fallo
    acierto_despues = % acierto despuÃ©s del fallo
  SI caÃ­da_media > 50%:
    score_regresion = ğŸ”´ ALTO

  â”€â”€ DecisiÃ³n â”€â”€
  SI score_evitacion == ğŸ”´ O score_regresion == ğŸ”´:
    GENERAR alerta ğŸŸ¡ "Emocional â€” Posible estrÃ©s ante retos"
  // Ansiedad: SIEMPRE ğŸŸ¡, nunca ğŸ”´ en la primera detecciÃ³n
```

---

#### Detector 6: DepresiÃ³n/ApatÃ­a â†’ `detectDepresion(uid)`

```
FUNCIÃ“N detectDepresion(uid, Ãºltimas_3_semanas):

  â”€â”€ Indicador A: Abandono progresivo â”€â”€
  sesiones_semana1 = COUNT(sesiones de hace 3 semanas)
  sesiones_semana3 = COUNT(sesiones de esta semana)
  SI sesiones_semana1 >= 4 Y sesiones_semana3 <= 1:
    score_abandono = ğŸ”´ ALTO

  â”€â”€ Indicador B: Sesiones ultra-cortas â”€â”€
  duraciones = LIST(endTime - startTime para cada sesiÃ³n)
  SI MEDIA(duraciones) < 120s (2 min):
    score_cortas = ğŸŸ¡ MEDIO

  â”€â”€ Indicador C: CaÃ­da global â”€â”€
  acierto_hace_3sem = % acierto global de hace 3 semanas
  acierto_ahora = % acierto global de esta semana
  SI caÃ­da > 20% EN TODAS las asignaturas simultÃ¡neamente:
    score_global = ğŸ”´ ALTO

  â”€â”€ Indicador D: Horario nocturno â”€â”€
  sesiones_nocturnas = COUNT(donde startTime.hour >= 22)
  SI sesiones_nocturnas / total > 0.50 durante > 1 semana:
    score_nocturno = ğŸŸ¡ MEDIO

  â”€â”€ DecisiÃ³n â”€â”€
  SI score_abandono == ğŸ”´ Y score_global == ğŸ”´:
    GENERAR alerta ğŸŸ¡ "Bienestar â€” Cambio notable de actividad"
  // DepresiÃ³n: alertar con MUCHO cuidado. Siempre ğŸŸ¡.
```

---

#### Detector 7: Bullying â†’ `detectBullying(uid)`

```
FUNCIÃ“N detectBullying(uid, Ãºltimas_2_semanas):

  // SOLO funciona si hay Modo Aula activo
  SI alumno NO tiene sesiones isClassroomMode == true:
    SALIR (no hay datos suficientes)

  â”€â”€ Indicador A: Aislamiento en aula â”€â”€
  sesiones_aula = COUNT(donde isClassroomMode == true) Ãºltimas 2 sem
  sesiones_casa = COUNT(donde isClassroomMode == false) Ãºltimas 2 sem
  SI sesiones_aula == 0 Y sesiones_casa >= 3:
    score_aislamiento = ğŸŸ¡ MEDIO

  â”€â”€ Indicador B: Abandono tras ranking â”€â”€
  // Requiere evento especial: 'viewed_leaderboard'
  abandonos_post_ranking = COUNT(sesiones que terminan < 30s despuÃ©s de ver ranking)
  SI abandonos_post_ranking >= 3:
    score_ranking = ğŸŸ¡ MEDIO

  â”€â”€ Indicador C: CaÃ­da brusca â”€â”€
  acierto_semana_anterior = % acierto hace 2 semanas
  acierto_esta_semana = % acierto esta semana
  SI caÃ­da > 30% Y NO hay cambio de trimestre:
    score_caida = ğŸŸ¡ MEDIO

  â”€â”€ DecisiÃ³n â”€â”€
  SI 2+ indicadores en ğŸŸ¡:
    GENERAR observaciÃ³n ğŸŸ¡ "Social â€” Cambio de comportamiento en grupo"
  // Bullying: SIEMPRE ğŸŸ¡. SIEMPRE discreto.
  // Solo visible para el PROFESOR, no para padres.
```

---

#### Detector 8: Problemas de VisiÃ³n â†’ `detectVision(uid)`

```
FUNCIÃ“N detectVision(uid, Ãºltimas_4_semanas):

  â”€â”€ Indicador A: Zoom/Pinch â”€â”€
  zooms = COUNT(donde gestureType == 'pinch_zoom')
  sesiones = COUNT(total sesiones)
  SI zooms / sesiones > 5:
    score_zoom = ğŸŸ¡ MEDIO

  â”€â”€ Indicador B: CorrelaciÃ³n texto grande vs pequeÃ±o â”€â”€
  acierto_grande = % acierto en ejercicios con fontSize >= 18
  acierto_pequeÃ±o = % acierto en ejercicios con fontSize < 14
  SI acierto_grande - acierto_pequeÃ±o > 40%:
    score_texto = ğŸŸ¡ MEDIO

  â”€â”€ Indicador C: TTS sin dislexia â”€â”€
  SI ratio_tts > 0.60 Y score_espejo < 2 Y score_secuencia == OK:
    // Usa TTS mucho pero NO confunde letras â†’ no es dislexia â†’ podrÃ­a ser visiÃ³n
    score_tts_vision = ğŸŸ¡ MEDIO

  â”€â”€ DecisiÃ³n â”€â”€
  SI 2+ indicadores en ğŸŸ¡:
    GENERAR observaciÃ³n ğŸŸ¡ "Visual â€” PodrÃ­a beneficiarse de revisiÃ³n Ã³ptica"
```

---

#### Detector 9: Falta de SueÃ±o â†’ `detectSueÃ±o(uid)`

```
FUNCIÃ“N detectSueÃ±o(uid, Ãºltimas_2_semanas):

  â”€â”€ Indicador A: Juego nocturno â”€â”€
  sesiones_23h = COUNT(donde startTime.hour >= 23)
  SI sesiones_23h >= 3 en 2 semanas:
    score_nocturno = ğŸŸ¡ MEDIO

  â”€â”€ Indicador B: Rendimiento lunes vs viernes â”€â”€
  acierto_lunes = AVG(% acierto en dÃ­a == lunes)
  acierto_viernes = AVG(% acierto en dÃ­a == viernes)
  SI acierto_lunes < acierto_viernes - 20%:
    score_lunes = ğŸŸ¡ MEDIO  // Peor los lunes = mal descanso fin de semana

  â”€â”€ Indicador C: MicrosueÃ±os â”€â”€
  pausas_largas = COUNT(gaps > 30s entre exerciseEvents dentro de la misma sesiÃ³n)
  SI pausas_largas > 3 por sesiÃ³n de media:
    score_pausas = ğŸŸ¡ MEDIO

  â”€â”€ DecisiÃ³n â”€â”€
  SI score_nocturno == ğŸŸ¡ Y (score_lunes == ğŸŸ¡ O score_pausas == ğŸŸ¡):
    GENERAR observaciÃ³n ğŸŸ¡ "Descanso â€” Patrones de sueÃ±o a observar"
```

---

#### Detector 10: Altas Capacidades â†’ `detectAltasCapacidades(uid)`

```
FUNCIÃ“N detectAltasCapacidades(uid, Ãºltimas_4_semanas):

  â”€â”€ Indicador A: Perfecto + ultrarrÃ¡pido â”€â”€
  caps_perfectos = COUNT(caps con 100% acierto)
  caps_totales = COUNT(caps completados)
  media_rt_alumno = AVG(responseTimeMs)
  media_rt_grupo = AVG(responseTimeMs del grupo de edad)
  SI caps_perfectos / caps_totales > 0.80 Y media_rt_alumno < media_rt_grupo * 0.50:
    score_rapido = ğŸŸ¢ ALTO

  â”€â”€ Indicador B: Aburrimiento selectivo â”€â”€
  completados_faciles = % caps completados de dificultad T1
  completados_dificiles = % caps completados de dificultad T3
  SI completados_dificiles > completados_faciles:
    score_aburrimiento = ğŸŸ¢ MEDIO

  â”€â”€ Indicador C: Busca desafÃ­os â”€â”€
  extras_encontrados = COUNT(puzzles ocultos + desafÃ­os extra completados)
  extras_disponibles = COUNT(puzzles ocultos + desafÃ­os extra disponibles)
  SI extras_encontrados == extras_disponibles:
    score_busca_retos = ğŸŸ¢ MEDIO

  â”€â”€ DecisiÃ³n â”€â”€
  SI score_rapido == ğŸŸ¢ Y (score_aburrimiento == ğŸŸ¢ O score_busca_retos == ğŸŸ¢):
    GENERAR alerta ğŸŒŸ "Talento â€” Rendimiento excepcional detectado"
    // Alerta POSITIVA: "podrÃ­a beneficiarse de retos adicionales"
```

---

#### Cloud Function: Orquestador semanal

```
// Cloud Function: runs every Sunday at 03:00
FUNCIÃ“N analyzeAllStudents():

  alumnos = QUERY Firestore: users WHERE role == 'student'

  PARA CADA alumno:
    datos = OBTENER ejercicios de Ãºltimas 4 semanas
    norma_grupo = OBTENER cache de normas por edad

    alertas = []

    resultado_tdah = detectTDAH(alumno.uid, datos, norma_grupo)
    SI resultado_tdah.nivel > NINGUNO: alertas.add(resultado_tdah)

    resultado_dislexia = detectDislexia(alumno.uid, datos)
    SI resultado_dislexia.nivel > NINGUNO: alertas.add(resultado_dislexia)

    resultado_discalculia = detectDiscalculia(alumno.uid, datos)
    SI resultado_discalculia.nivel > NINGUNO: alertas.add(resultado_discalculia)

    resultado_tea = detectTEA(alumno.uid, datos)
    resultado_ansiedad = detectAnsiedad(alumno.uid, datos)
    resultado_depresion = detectDepresion(alumno.uid, datos)
    resultado_bullying = detectBullying(alumno.uid, datos)
    resultado_vision = detectVision(alumno.uid, datos)
    resultado_sueÃ±o = detectSueÃ±o(alumno.uid, datos)
    resultado_altas = detectAltasCapacidades(alumno.uid, datos, norma_grupo)

    // Guardar alertas en Firestore
    PARA CADA alerta en alertas:
      // No duplicar: si ya existe una alerta del mismo tipo sin resolver
      existente = QUERY alerts/{uid} WHERE tipo == alerta.tipo Y resuelta == false
      SI existente == null:
        ESCRIBIR Firestore: alerts/{uid}/{alertId}
        {
          tipo: alerta.tipo,           // 'atencion', 'lectura', 'matematicas'...
          nivel: alerta.nivel,         // 'observacion' o 'alerta'
          mensaje: alerta.mensaje,     // Texto en lenguaje positivo
          datos: alerta.metricas,      // Los nÃºmeros de soporte
          fecha: ahora,
          resuelta: false,
          visiblePara: ['padres', 'profesor']  // o solo ['profesor'] para bullying
        }
```

| Regla | Detalle |
|---|---|
| âŒ **NUNCA diagnosticar** | La app NO dice "su hijo tiene TDAH". NUNCA. |
| âœ… **Solo alertar** | "Hemos notado un patrÃ³n que podrÃ­a beneficiarse de atenciÃ³n especializada" |
| âŒ **NUNCA al niÃ±o** | Las alertas van SOLO al dashboard de padres/profesor. El niÃ±o no ve nada |
| âœ… **Sugerir profesional** | Siempre terminar con: "Recomendamos consultar con el orientador del centro" |
| âŒ **NUNCA etiquetar** | No usar palabras mÃ©dicas ("TDAH", "dislexia") en la alerta |
| âœ… **Lenguaje positivo** | "MarÃ­a muestra fortaleza en Mates pero podrÃ­a beneficiarse de apoyo en Lengua" |
| âŒ **NUNCA compartir datos** | Los datos de detecciÃ³n son PRIVADOS. Solo padres y profe vinculado |
| âŒ **NUNCA publicar rankings de "problemas"** | Ni el profe ve un listado de "alumnos con dificultad" |
| âœ… **Consentimiento GDPR/COPPA** | Los padres deben aceptar la recogida de datos de detecciÃ³n explÃ­citamente |

---

### QuÃ© datos recoge el "Ojo de OriÃ³n"

| Dato recogido por ejercicio | TamaÃ±o | Para quÃ© sirve |
|---|---|---|
| `timestamp` | 8 bytes | Hora de juego, variabilidad RT, patrones diarios |
| `responseTimeMs` | 4 bytes | RT-ISV (TDAH), conteo con dedos (discalculia), fatiga |
| `isCorrect` | 1 byte | Perfil espinoso, caÃ­das de rendimiento |
| `errorType` | enum | ConfusiÃ³n b/d (dislexia), valor posicional (discalculia) |
| `ttsUsed` | 1 byte | Dislexia, problemas de visiÃ³n |
| `runeUsed` | enum | Ansiedad (uso compulsivo) |
| `sessionDuration` | 4 bytes | Abandono (TDAH), sesiones ultra-cortas (depresiÃ³n) |
| `exercisePosition` | 2 bytes | Efecto principio-final (TDAH), fatiga visual |
| `gestureType` | enum | Zoom/pinch (visiÃ³n), patrones repetitivos (TEA) |

**Almacenamiento estimado**: ~30 bytes Ã— 20 ejercicios Ã— 5 sesiones/semana = **3KB/semana por niÃ±o** = negligible.

---

### Arquitectura del Motor de AnÃ¡lisis

```
     ğŸ“± APP (Client)                    â˜ï¸ SERVIDOR
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     ExerciseEvent {                    Cloud Function (semanal):
       timestamp,                       1. Agregar datos por alumno
       responseTimeMs,                  2. Calcular mÃ©tricas:
       isCorrect,                          - RT variability (Ïƒ)
       errorType,                          - Perfil por asignatura
       ttsUsed,                            - Tasa de abandono
       ...                                 - Hora media de juego
     }                                  3. Comparar vs. norma (grupo edad)
        â”‚                               4. Si supera umbral â†’ crear alerta
        â””â”€â”€â†’ Firestore:                       â”‚
             exercises/{uid}/{sessionId}       â–¼
                                        Firestore: alerts/{uid}
                                              â”‚
                                         Dashboard padres â†â”€â”€â”˜
                                         Dashboard profe  â†â”€â”€â”˜
```

---

### AnÃ¡lisis de Costes (Firebase)

> El sistema de detecciÃ³n es prÃ¡cticamente gratuito porque los datos son diminutos (30 bytes/ejercicio) y el anÃ¡lisis se ejecuta solo 1 vez/semana.

#### Almacenamiento (Firestore)

| Escala | Datos/mes | Coste |
|---|---|---|
| 1.000 alumnos | 12 MB | Gratis (< 1 GB free tier) |
| 10.000 alumnos | 120 MB | Gratis |
| 100.000 alumnos | 1.2 GB | ~$0.22/mes |

#### Cloud Function semanal + Lecturas

| Escala | Compute | Reads Firestore | Coste |
|---|---|---|---|
| 1.000 alumnos | 2 min/mes | 20K reads/semana | Gratis |
| 10.000 alumnos | 8 min/mes | 200K reads/semana | ~$0.10/mes |
| 100.000 alumnos | 20 min/mes | 2M reads/semana | ~$1.21/mes |

#### Resumen total

| Escala | **Coste total/mes** |
|---|---|
| **1.000 alumnos** | **$0.00** |
| **10.000 alumnos** | **~$0.10** |
| **100.000 alumnos** | **~$1.43** |

> ğŸ’¡ El coste real estÃ¡ en el **tiempo de desarrollo** y la **validaciÃ³n con psicÃ³logos educativos**, no en la infraestructura.

---

### LÃ­nea temporal de implementaciÃ³n

| Fase | QuÃ© | CuÃ¡ndo | ValidaciÃ³n necesaria |
|---|---|---|---|
| **v1** | Solo recolectar datos (ninguna alerta) | Lanzamiento | Solo GDPR/COPPA |
| **v2** | Alertas de perfil espinoso + horas de juego | +3 meses | RevisiÃ³n legal |
| **v3** | RT variability (TDAH) + TTS excesivo (dislexia) | +6 meses | Estudio piloto con 50+ alumnos |
| **v4** | Patrones emocionales (ansiedad, abandono) | +12 meses | ValidaciÃ³n con psicÃ³logos educativos |
| **v5** | Altas capacidades + detecciÃ³n fina | +18 meses | Datos de 500+ alumnos |

> âš ï¸ **Cada fase requiere**: validaciÃ³n de umbrales con datos reales, revisiÃ³n por psicÃ³logos educativos, y aprobaciÃ³n legal. NO lanzar alertas sin validaciÃ³n.

